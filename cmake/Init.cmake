MESSAGE(STATUS "Include Init.cmake")

INCLUDE("${CMAKE_CURRENT_LIST_DIR}/Basic.cmake")
INCLUDE("${CMAKE_CURRENT_LIST_DIR}/Build.cmake")
INCLUDE("${CMAKE_CURRENT_LIST_DIR}/Download.cmake")
INCLUDE("${CMAKE_CURRENT_LIST_DIR}/Git.cmake")
INCLUDE("${CMAKE_CURRENT_LIST_DIR}/Package.cmake")
INCLUDE("${CMAKE_CURRENT_LIST_DIR}/Qt.cmake")
INCLUDE("${CMAKE_CURRENT_LIST_DIR}/Tools.cmake")

# ---------------------------------------------------------

SET(CMAKE_DEBUG_POSTFIX d)

SET(CMAKE_CXX_STANDARD 17)
SET(CMAKE_CXX_STANDARD_REQUIRED True)

IF (MSVC)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /permissive-")
ENDIF ()

IF (CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
    PATH_BACK(ROOT ${CMAKE_INSTALL_PREFIX} 1)
    SET(CMAKE_INSTALL_PREFIX "${ROOT}/My" CACHE PATH "install prefix" FORCE)
ENDIF ()

SET("BUILD${PROJECT_NAME}TEST" OFF CACHE BOOL "Build tests for ${PROJECT_NAME} ")
SET(BUILD_TEST OFF CACHE BOOL "Build tests for all projects")

SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${PROJECT_SOURCE_DIR}/bin")
SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG "${PROJECT_SOURCE_DIR}/bin")
SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE "${PROJECT_SOURCE_DIR}/bin")
SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY "${PROJECT_SOURCE_DIR}/lib")
SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_DEBUG "${PROJECT_SOURCE_DIR}/lib")
SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELEASE "${PROJECT_SOURCE_DIR}/lib")
SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY "${PROJECT_SOURCE_DIR}/lib")
SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY_DEBUG "${PROJECT_SOURCE_DIR}/lib")
SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY_RELEASE "${PROJECT_SOURCE_DIR}/lib")

SET_PROPERTY(GLOBAL PROPERTY USE_FOLDERS ON)

# Natvis
IF (MSVC AND EXISTS "${PROJECT_SOURCE_DIR}/config/natvis.in")
    IF (NOT TARGET MY_NATVIS)
        FILE(WRITE "${CMAKE_CURRENT_BINARY_DIR}/NatvisEmpty.cpp" "// generated by MyCMake for natvis\nint main(){ return 0; }\n")
        ADD_EXECUTABLE(MY_NATVIS "${CMAKE_CURRENT_BINARY_DIR}/NatvisEmpty.cpp")
    ENDIF ()
    PACKAGE_NAME(PACKAGE_NAME)
    SET(NATVIS_FILE "${CMAKE_CURRENT_BINARY_DIR}/${PACKAGE_NAME}.natvis")
    SET(CONFIG_MYCMAKE_NATVIS "<!-- \n    Generated by MyCMake ${MyCMake_VERSION} for natvis\n    Any changes to this file will be overwritten by the next CMake run\n-->")
    CONFIGURE_FILE("${PROJECT_SOURCE_DIR}/config/natvis.in" ${NATVIS_FILE})
    TARGET_SOURCES(MY_NATVIS PRIVATE ${NATVIS_FILE})
    INSTALL(
            FILES ${NATVIS_FILE}
            DESTINATION "${PACKAGE_NAME}/cmake"
    )
ENDIF ()